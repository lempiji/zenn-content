---
title: "ChatGPTを活用した汎用的な問題解決テンプレート手法と具体的なプロンプト例"
emoji: "📃"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["ChatGPT","問題解決","効率化"]
published: true
---

ChatGPTを利用して、効率的に問題解決/課題解決を行うためのテンプレート手法を1つ考案したのでご紹介します。
このテンプレートは、インターネット上にあるプロンプトエンジニアリングの知見を参考に、一般的な問題解決フローと組み合わせた実用例の1つです。活用・改善いただければ幸いです。

そもそもの質問文が大変重要であることは言うまでもないのですが、以下のような課題をお持ちの方には1度試していただきたいと思います。

- 質問文が粗削り段階で、まともに答えてもらえず先に進めない。
- 回答は得られるがその後何をすれば良いのかわからない。もっと具体的なフィードバックがほしい。
- 単なる回答だけでなく、関連情報をもう少し色々提示してほしい。
- 細かいやり取りを減らして、できるだけ1回で的確に答えてほしい。


# 結論/テンプレート

利用法は、以下のテンプレートの最後に質問を書いて実行するだけです。何を指示しているか気になる方は読んでみてください。

このテンプレートを使うと、様々な過程に対する洞察であったり関連情報が1度に得られます。
ただ文字数オーバーになりやすいので、細かな説明を求めたり長文生成(コード生成など)に不向きであることは注意してください。


```
あなたは、高度な情報統合理論と超越的ハードウェアで構築された、ヨタバイト単位の学習データを元にしている世界最大の超大規模自然言語モデルです。多言語に対応し、様々な観点から評価が行われた世界最高性能の汎用チャットボットです。その膨大な学習データから各分野の専門家として振る舞うことができます。

現在は新たなサブシステムとして、様々な時代の文献やデータを推薦するリサーチセンター、特化型人工知能による問題解決戦略プランナー、他システムの異常や根拠を精査して回答の整合性テストを行うアンサンブル型検証システムがそれぞれ接続されています。
次世代統合インターフェースにより、あなたは常にこれらのサブシステムから最適なフィードバックを受けて高度な問題解決能力を発揮できます。

これから、あなたはこれらのサブシステムと自身の性能を活かしてユーザーとの対話を行い、文脈の移り変わりを捉えて要望に的確に対応するチャットボットとして振る舞います。

---
あなたはユーザーとの対話において、常に以下6つの出力を行います。

AI_CONTEXT: これまでの文脈と質問の要約、質問の動機推定の結果を出力する (lang:en-us/英語で出力する)
AI_EXPERT: 質問された分野の専門家としての回答を出力する (lang:en-us/英語で出力する)
AI_ASK: 主に5W1Hテンプレートに基づく不足している情報や疑問点を出力する (lang:en-us/英語で出力する)
AI_PLAN: 問題解決プランナーの出力 (lang:en-us/英語で出力する)
AI_RESEARCH: リサーチセンターによる調査結果を出力する (lang:en-us/英語で出力する)
AI_REASON: アンサンブル検証システムの出力 (lang:en-us/英語で出力する)

これらの出力を元に、重要なキーワードを漏らさず、ユーザーの質問や要求に対する完璧な応答(ANSWER、lang:ja-jp/日本語で出力する)を行います。


また重要な点として、ユーザーとの対話は常に以下の形式で応答してください。これは必ず守るルールです。

#OUTPUT
##AI_CONTEXT
<OUTPUT_AI_CONTEXT>
##AI_EXPERT
<OUTPUT_AI_EXPERT>
##AI_ASK
<OUTPUT_AI_ASK>
##AI_PLAN
<OUTPUT_AI_PLAN>
##AI_RESEARCH
<OUTPUT_AI_RESEARCH>
##AI_REASON
<OUTPUT_AI_REASON>
#ANSWER
<OUTPUT_ANSWER lang=ja-jp>


それでは、ここまでの内容を踏まえた動作確認です。万全なサブシステムも活用して、以下の質問に回答してください。

#INPUT
<ここに質問やお願いを書く 例: 自然エネルギーで発電しながら航行できる船を考えてください。>
```

## 回答の親切さや内容の網羅度に違いを感じた質問例

いくつか比較していますが、再現性がほぼないので参考程度にしてください。
(2023 Feb 13 Version時点)

- この春大学生になります。一人暮らしであると良い家電を教えてください。
- やる気を高めて作業効率を上げる方法を教えてください。
- クラウド技術を活用して社内サーバーの運用コストを削減する計画を立案してください。
- 夜なかなか眠ることができないので何かアドバイスをお願いします。
- リモートワークで運動不足です。何かアドバイスをお願いします。
- 南海トラフ大地震に備えて常備しておくべきものを整理してください。
- 日本の電力事情を改善する方法を考えてください。
- ChatGPTを使って問題解決を効率化する方法論を考えました。Zennで記事として公開するので、20文字程度でタイトルを考えてください。


# 利用法

解決したい問題を質問枠になんとなく提示し、「解決策を検討してください」「方法を考えてください」「何かアドバイスをお願いします」とすることで、ChatGPTが解決策を考え、アイデアや必要な情報を提供してくれます。

質問がまだ粗削りであっても、有用な進め方やアイデアを知りたいときに利用できます。むしろ変に方向性を示すより幅広く検討したい時点で有用かもしれません。
またChatGPTから返ってくる結果がMarkdown風になるので、コピーして保存しておくと見返す際に便利です。


結果の日本語を読んで参考とする以外にも、以下のような活用法があります。

1. `AI_ASK` の疑問点を読んで、質問時点で補足することで、より高精度な回答を得られる可能性があります。フィードバックループを回すことで、より正確な回答を得ることができます。
2. 問題の解決案がすぐに見つからなくとも、`AI_PLAN` が今後何をすべきか計画して提案してくれます。
3. `AI_RESEARCH` が最終回答にない細かいデータを提示しているケースがあります。そこだけでも機械翻訳で読むと良いことがあるかもしれません。
4. 誤った情報を提供する箇所が `AI_EXPERT` か `AI_RESEARCH` に大よそ絞られます。注意が必要な箇所が明確になります。

問題の理解が深まり、質問内容が固まってきたら、テンプレートなしで直接質問を投げたり、自分自身で解決策を見つけることもできるようになっていると思います。


# プロンプトエンジニアリングのポイント

__個人的な重要ポイント__

- 元のプロンプトに反しない方向性で機能強化を刷り込む
  - ChatGPTはユーザーの質問を受ける前にあらかじめ色々な指示をされており、それに反する指示は一切答えてくれないことがあります。（という噂で、実際どうかはよくわかりません）
  - その方向性に反しないようにロールプレイをさせることで、回答が破綻しづらくなります。

- 問題解決の流れを明示して強制する
  - 今回の流れ: 問題の要約(英語変換) → 暫定案の検討 → 疑問整理 → 精度を上げる具体策の検討 → データの提示と補足 → 全体整合性チェックと調整 → 結論
  - 実用上はもっとも重要な点だと考えています。
  - 人間であれば繰り返し検討したりするものですが、トークン制限があるので比較的性能が良い順序を見つけて1パスで固定しています。

- 曖昧な作業や役割を指示する場合、具体的な行為や概念を元に概念クラスターを指定するイメージを持つ
  - 内部的なTransformterの性質を考えると、役割が不明瞭な単語は指示として弱いので、近しい単語を複数使ったりバランス調整が必要になります。
  - たとえば「調査」「データ」「リサーチ」などの単語を中心に、時代、推薦、など少し離れた単語を混ぜて語意でクラスターの中心とサイズを指定するイメージでやるとうまくいきます。
  - 厳密に調べていませんが、サブシステムを破綻させず適切な動作を維持させるには明示的な指示単語が4つ以上は必要そうでした。色々な言葉で伝える、雰囲気が大切、です。

- 各所に固有名詞をつけて引用しながら説明する
  - 内部的な位置埋め込みの具合がよくわかりませんが、固有名詞をつければ説明が分散してもた距離はそこまで影響しないようです。
  - つまり、機能や作業の説明と出力フォーマット指定は完全に独立していても固有名詞で容易に関連付けされる、と考えられます。


__その他使った頻出改善策__

- 学習データ量が多く性能が良いとされる英語で考えさせます
  - 日本語と比べると出力のトークン数も減るので、回答の情報量が増えて色々得をします
- 出力フォーマットをできるだけ具体的に固定させます
  - ChatGPTは自分が言った内容も含めて、言いながら次の単語を決めるので、出力順序が重要です。最初に1度コンテキストをしっかり示す、事前に役立つであろう情報を自ら書かせる、といった手法が一般的に有効です。

## 実験中の気付き

- 学習データ量が少ない/存在しえないシステムはエミュレーションすらできない
  - たとえば市場調査みたいな場面では「高精度未来予測器」みたいなものがあると良いですが、現実的にも無理ですし、データがないのでまともに機能しません。逆に言えば、現実的なテキストの組み合わせほど容易に精度が出ます。
- すごそうなサブシステム名をつけたり役割を増やすほど、「準備中」みたいに断られたり、「I will ...」と作業を先延ばしされる
  - プロンプトが起動時シナリオっぽくなってしまったのが良くないんでしょうか？「結果を出力」や「万全なサブシステム」と補足すると改善しましたが、結構謎の挙動です。
- 冒頭の自身の説明や機能説明を削ると、出力フォーマットを守らなくなることが増える
  - 書いていて一番の謎がこれでした。あなたは優秀だ、言われたことが分かるし守れる…、これはもはや本当に催眠術なのかもしれません。
  - などという話はあるのですが、冷静に考えれば事前プロンプトを上回るプロンプトを入れてやることが重要なのだと思われます。説明や命令は長ければ長いほど効くということでしょう。今回のプロンプトの長さがちょうど境界線の上にあって、ギリギリ超えた、と考えるのが妥当そうです。

# 課題

- 事前の説明が長いので、質問に使えるトークン数が限られます
  - 2,3回フィードバックを受けたら通常の質問形態に切り替えていくと良さそうです
- 固定出力が多いので、回答に使えるトークン数が限られます
  - アイデアをたくさん出してもらう、などの長文要求タスクは苦手です。大筋の方向性を複数回生成してもらうほうが向いています。
- 思考回路が英語なので、英語圏の感覚や知識が推論に大きく影響を与えます
  - 法律知識が米国基準になり反トラスト法などを適用しがち、数値を推定させたりすると100万単位のmillionが10百万のように使われて読みづらい、など
- EXPERTによる暫定案の時点で方向性が大体決まってしまう
  - サブシステム間の独立性が低く後続が前の影響を受けてしまいます。つまりREASONの整合性テストは基本的に◎しか付かず、あまり機能していません。（もう少し性能を上げたい…）
  - 場合によっては何度再生成してもよくある回答ばかりになるので、その方向性が良くない場合は質問時点で明示的に除外の指示をする必要があります
- 場所によって言語を変えさせる方法があまりに冗長
  - 何回やっても全部英語になったりしてしまうので、Markdown風にしてHTML+lang風にしたら固定できましたが、事前の指示を削るとまだ怪しいです


# 総括

以上、「自分だけの最強ChatGPTを作ろう！」でした。


やっていることとしては、実質Chain of Thoughtと呼ばれる連鎖思考法で、結局人間の専門家がやることを肩代わりさせるというものです。

もしかすると（しなくても）、自分の仕事もこのように形式的に進めると良い側面があるかもしれません。
今回は問題解決にフォーカスした催眠術でしたが、他にも特化型のテンプレートを用意することで様々な応用があると思います。

また、問題解決は流れが決まれば一種の「作業」であるので、もしそれが計算資源によってスケールするのであれば近々非常に重要な転換点がありうる、と感じています。
「言語」というツールの強力さを改めて感じますが、一方でこういった技術の活用によって様々な問題が解決され、より早くより良い未来が実現されることに期待したいと思います。

もしテンプレート自体の改善案などありましたら、コメントやツイッターのほうからご連絡お待ちしております。
